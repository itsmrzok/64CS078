#!/usr/bin/env bash

## Install script for Ubuntu

set -e
path=/usr/local/bin

# Check if curl is installed
if ! command -V curl > /dev/null 2>&1; then
  echo "curl not installed, please install it with 'sudo apt install curl' and try again"
  exit
fi

# Check if user provided a custom path (optional)
if ! [ -z "$1" ]; then
  path=$1
  # Warn user that custom path might require manual PATH update
  echo "WARNING: Custom installation path provided. You might need to update your PATH environment variable for tgpt to be accessible."
fi

echo "Download location: $path"

# Check write permissions for the target path
if [ ! -w "$path" ]; then
  # Use sudo if needed
  SUDO="sudo"
else
  SUDO=""
fi

# Detect architecture (assuming Ubuntu uses x86_64 or i386)
case $(uname -m) in
  x86_64) ARCH="amd64" ;;
  i386 | i686) ARCH="i386" ;;
  *) echo "Unsupported architecture: $(uname -m)"; exit 1 ;;
esac

# Set download URL for Ubuntu (assuming amd64 and i386)
URL="https://github.com/aandrew-me/tgpt/releases/latest/download/tgpt-linux-${ARCH}"

# Download the executable
echo -e "Downloading...\n"
curl -SL --progress-bar "$URL" -o /tmp/tgpt

# Move the executable to the target path
$SUDO mv /tmp/tgpt $path

# Set executable permissions
if [ -d "$path" ]; then
  $SUDO chmod +x $path/tgpt
elif [ -f "$path" ]; then
  $SUDO chmod +x $path
fi

echo -e "Installed Successfully \n"

# Inform user about PATH (if custom path used)
if [[ $path != "/usr/local/bin" ]]; then
  echo "Make sure your PATH environment variable includes '$path' for tgpt to be accessible globally."
fi
echo -e "OS project by 22CS064 ||  22CS078 "
echo -e "PROJECT teacher BUSHRA NAAZ"
echo -e "Run tgpt -h for help"
